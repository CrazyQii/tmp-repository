(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d230cc3"],{ee8e:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("a-steps",[i("a-step",{attrs:{status:"finish",title:"信息确认"}},[i("a-icon",{attrs:{slot:"icon",type:"form"},slot:"icon"})],1),i("a-step",{attrs:{status:"wait",title:"待支付"}},[i("a-icon",{attrs:{slot:"icon",type:"transaction"},slot:"icon"})],1),i("a-step",{attrs:{status:"wait",title:"支付成功"}},[i("a-icon",{attrs:{slot:"icon",type:"smile-o"},slot:"icon"})],1)],1),i("a-descriptions",{staticStyle:{"margin-top":"2rem"},attrs:{title:"航班信息确认",layout:"vertical",bordered:""}},[i("a-descriptions-item",{attrs:{label:"航空公司"}},[t._v(" "+t._s(t.flight.flight_company)+" ")]),i("a-descriptions-item",{attrs:{label:"起始地"}},[t._v(" "+t._s(t.flight.from_pos)+" ")]),i("a-descriptions-item",{attrs:{label:"起飞时间"}},[t._v(" "+t._s(t.flight.start_time)+" ")]),i("a-descriptions-item",{attrs:{label:"飞机型号"}},[t._v(" "+t._s(t.flight.flight_type)+" ")]),i("a-descriptions-item",{attrs:{label:"到达地"}},[t._v(" "+t._s(t.flight.to_pos)+" ")]),i("a-descriptions-item",{attrs:{label:"到达时间"}},[t._v(" "+t._s(t.flight.end_time)+" ")])],1),i("a-row",{staticStyle:{margin:"2rem 0rem"},attrs:{type:"flex",justify:"end"}},[i("a-col",{attrs:{span:18}},[t._v(" 乘客信息列表 ")]),i("a-col",{attrs:{span:4}},[i("a-button",{staticStyle:{"margin-right":"2rem"},attrs:{type:"info"},on:{click:function(e){return t.addPassenger()}}},[t._v("添加乘客信息")])],1)],1),i("a-list",{attrs:{loading:t.loading,"item-layout":"horizontal","data-source":t.users},scopedSlots:t._u([{key:"renderItem",fn:function(e){return i("a-list-item",{staticStyle:{padding:"0 5rem"}},[i("a-list-item-meta",[i("span",{attrs:{slot:"title"},slot:"title"},[i("span",{staticStyle:{"margin-left":"5rem",width:"10rem"}},[t._v(t._s("姓名："+e.name))]),i("span",{staticStyle:{"margin-left":"5rem",width:"10rem"}},[t._v(t._s(" 身份证: "+e.id_card))]),i("span",{staticStyle:{"margin-left":"5rem",width:"10rem"}},[t._v(t._s(" 手机号码："+e.phone))])])]),i("a-button",{attrs:{type:"danger",shape:"round",size:"small"},on:{click:function(i){return t.deleted(e.id_card)}}},[t._v("删除")])],1)}}])}),i("a-row",{staticStyle:{"margin-top":"2rem"},attrs:{type:"flex",justify:"end"}},[i("a-col",{attrs:{span:4}},[i("span",{staticStyle:{"font-weight":"700","font-size":"20px"}},[t._v("价格:"),i("span",{staticStyle:{color:"red","margin-left":"1rem"}},[t._v("￥"+t._s(t.flight.price*this.users.length))])])]),i("a-col",{attrs:{span:4}},[i("a-button",{staticStyle:{"margin-right":"2rem"},attrs:{type:"primary"},on:{click:function(e){return t.confirm()}}},[t._v("确认")])],1)],1),t.reFresh?i("a-drawer",{attrs:{title:"乘客信息登记",width:720,visible:t.visible,"body-style":{paddingBottom:"80px"}},on:{close:t.onClose}},[i("PassengerInfo",{attrs:{user_info:t.user_info,flight_id:t.id}})],1):t._e(),i("a-modal",{attrs:{visible:t.modelVisible,title:"确认弹窗","ok-text":"确认","cancel-text":"取消"},on:{ok:t.handleOk,cancel:t.cancelOk}},[i("p",[t._v("是否确认购买机票")])])],1)},a=[],r=(i("99af"),i("cf45")),n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{width:"60%",margin:"0 auto"}},[i("a-form",{attrs:{form:t.form},on:{submit:t.handleSubmit}},[i("a-form-item",{attrs:{"has-feedback":""}},[i("span",{attrs:{slot:"label"},slot:"label"},[t._v(" 姓名 ")]),i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入您的姓名",whitespace:!0}]}],expression:"[\n                'name',\n                {\n                    rules: [{ required: true, message: '请输入您的姓名', whitespace: true }],\n                },\n                ]"}]})],1),i("a-form-item",{attrs:{"has-feedback":""}},[i("span",{attrs:{slot:"label"},slot:"label"},[t._v(" 身份证号码 ")]),i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["id_card",{rules:[{required:!0,message:"请输入您的身份证号码",whitespace:!0}]}],expression:"[\n                'id_card',\n                {\n                    rules: [{ required: true, message: '请输入您的身份证号码', whitespace: true }],\n                },\n                ]"}]})],1),i("a-form-item",{attrs:{label:"手机号码"}},[i("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["phone",{rules:[{required:!0,message:"请输入你的手机号码!"}]}],expression:"[\n                'phone',\n                {\n                    rules: [{ required: true, message: '请输入你的手机号码!' }],\n                },\n                ]"}],staticStyle:{width:"100%"}},[i("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["prefix",{initialValue:"86"}],expression:"['prefix', { initialValue: '86' }]"}],staticStyle:{width:"70px"},attrs:{slot:"addonBefore"},slot:"addonBefore"},[i("a-select-option",{attrs:{value:"86"}},[t._v(" +86 ")])],1)],1)],1),i("a-form-item",[i("a-button",{attrs:{type:"primary","html-type":"submit"}},[t._v(" 添加 ")])],1)],1)],1)},o=[],l=(i("b0c0"),{name:"PassengerInfo",props:{user_info:{type:Object},flight_id:{type:String}},data:function(){return{passenger:{}}},beforeCreate:function(){this.form=this.$form.createForm(this,{name:"register"})},methods:{handleSubmit:function(t){var e=this;this.loading=!0,t.preventDefault(),this.form.validateFieldsAndScroll((function(t,i){if(t)e.loading=!1;else{var s={id_card:i["id_card"],phone:i["phone"],flight_id:e.flight_id,name:i["name"],account_id:e.user_info.id};e.$flight_api.post_passenger(s).then((function(t){console.log(t),200==t.code?(e.passenger=t.data,e.$message.success("添加乘客成功! "),e.$router.go(0)):e.$message.error("添加乘客信息失败! "+t.msg),e.loading=!1})).catch((function(){e.$message.error("乘客信息已经存在! ")}))}}))}}}),c=l,d=i("2877"),h=Object(d["a"])(c,n,o,!1,null,null,null),u=h.exports,m={name:"FlightDetail",components:{PassengerInfo:u},data:function(){return{id:this.$route.params.id,flight:{},users:[],visible:!1,reFresh:!0,user_info:{},loading:!1,modelVisible:!1}},mounted:function(){this.get_userinfo(),this.get_flight(this.id)},methods:{get_userinfo:function(){var t=this;this.$user_api.user_info().then((function(e){200==e.code?(t.user_info=e.data,console.log(t.user_info),t.get_passengers()):(t.$message.error("用户信息获取失败:"+e.msg),localStorage.removeItem("token"),t.$router.push({path:"/login"}))}))},get_flight:function(t){var e=this,i={flight_id:t};this.loading=!0,this.$flight_api.get_flight(i).then((function(t){console.log(t),200==t.code?(e.flight=t.data,e.flight.start_time=Object(r["d"])(e.flight.start_time),e.flight.end_time=Object(r["d"])(e.flight.end_time)):e.$message.error("请求数据失败! "+t.msg),e.loading=!1}))},get_passengers:function(){var t=this;this.loading=!0;var e={flight_id:this.id,account_id:this.user_info.id};console.log(e),this.$flight_api.get_passenger(e).then((function(e){console.log(e),200==e.code?t.users=e.data:t.$message.error("乘客信息获取失败:"+e.msg),t.loading=!1}))},confirm:function(){0==this.users.length?this.$message.error("请添加至少一位乘客"):this.modelVisible=!0},cancelOk:function(){this.modelVisible=!1},handleOk:function(){var t=this;this.loading=!0;var e={money:this.flight.price*this.users.length,flight_id:this.id,account_id:this.user_info.id};this.$flight_api.post_order(e).then((function(e){console.log(e),200==e.code?(t.$message.success("生成订单成功"),t.$router.push({path:"/wait-pay/".concat(e.data.id)}),window.open("http://localhost:5000/order/pay?order_id=".concat(e.data.id,"&money=").concat(e.data.money,"&name=航班--").concat(t.flight.flight_type),"_blank")):t.$message.error("生成订单失败:"+e.msg),t.loading=!1}))},addPassenger:function(){var t=this;this.visible=!0,this.reFresh=!1,this.$nextTick((function(){t.reFresh=!0}))},onClose:function(){this.visible=!1},deleted:function(t){var e=this;this.loading=!0;var i={id_card:t,account_id:this.user_info.id};console.log(i),this.$flight_api.remove_passenger(i).then((function(t){console.log(t),200==t.code?(e.users=t.data,e.$message.success("删除乘客信息成功！")):e.$message.error("删除乘客信息失败:"+t.msg),e.loading=!1}))}}},g=m,f=Object(d["a"])(g,s,a,!1,null,null,null);e["default"]=f.exports}}]);
//# sourceMappingURL=chunk-2d230cc3.f319c5e0.js.map